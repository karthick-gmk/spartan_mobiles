{% extends 'base.html' %}
{%block content%}
{% load static %}

<section class="latest spad">
  <div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div class="section-title">
                <span>Our Services</span>
                <h2>Mobile Repair & Support</h2>
            </div>
        </div>
    </div>

    <div class="row">
      {% for servicetype in servicetypes %}
      <div class="col-lg-4 col-md-6 col-sm-6">
          <div class="blog__item">
              <div class="blog__item__pic set-bg" data-setbg="{% if servicetype.image_url %}{{ servicetype.image_url }}{% else %}{% static 'images/default-service.jpg' %}{% endif %}"></div>
              <div class="blog__item__text">
                  <span><img src="{% static 'img/calendar.png' %}" alt=""> {{ servicetype.service_type }}</span>
                  <h5>{{ servicetype.service.name }}</h5>
                  <p>{{ servicetype.discription }}</p>
                  <p class="offer">
                      <span style="color:red;" class="offer-text">{{ servicetype.text }}</span>
                  </p>
                  <a href="#service_req">Service Request</a>
              </div>
          </div>
      </div>
      {% empty %}
      <div class="col-12">
          <p>No services available at the moment.</p>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

  
<section class="form_req" id="service_req">
  <main class="card" role="main">
    <aside class="aside" aria-hidden="true">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="logo">SP</div>
        <div>
          <div style="font-size:12px;opacity:.95">SPARTANS</div>
          <div style="font-weight:700">Request Service</div>
        </div>
      </div>
      <h3 style="margin-top:12px; color:white;">Create a service request</h3>
      <p style="opacity:.9">Choose the category, brand & model, set expected delivery date and price.</p>
    </aside>

    <section class="body">
      <div class="head">
        <h2>Create Request</h2>
        <p>Fill details for the user service request</p>
      </div>

      {% if messages %}
          {% for message in messages %}
              <div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% endif %}">
                  {{ message }}
              </div>
          {% endfor %}
      {% endif %}

      {% if request.user.is_authenticated %}
          <!-- Show form only for logged in users -->
          <form method="post">
            {% csrf_token %}
            <div>
              <label for="user">User</label>
              <input type="hidden" name="user_id" value="{{ request.user.id }}">
              <input type="text" value="{{ request.user.first_name }} ({{ request.user.username }})" readonly style="background-color: #f5f5f5;">
            </div>

            <div>
              <label for="service">Service</label>
              <select id="service" name="service_id" required>
                <option value="">— Select service —</option>
                {% for service in services %}
                  <option value="{{ service.id }}">{{ service.name }}</option>
                {% endfor %}
              </select>
            </div>


            <div>
              <label for="brand">Brand</label>
              <select id="brand" name="brand_id" required>
                <option value="">— Select brand —</option>
                {% for brand in brands %}
                  <option value="{{ brand.id }}">{{ brand.name }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="full">
              <label for="brandModel">Brand Model</label>
              <input id="brandModel" name="brand_model_id" type="text" placeholder="Enter your Brand Model" required autocomplete="off"/>
            </div>


            <div class="full">
              <label for="notes">Notes (optional)</label>
              <textarea id="notes" name="notes" rows="3" placeholder="Anything extra the user said..."></textarea>
            </div>

            <div class="actions full">
              <div style="font-size:13px;color:var(--muted)">Request will record request_date automatically on server.</div>
              <div style="display:flex;gap:10px">
                <button type="reset" class="btn btn--ghost">Reset</button>
                <button type="submit" class="btn">Create Request</button>
              </div>
            </div>
          </form>

          {% else %}
          <!-- Show login buttons for non-authenticated users -->
          <div class="login-required" style="text-align:center;padding:40px 20px;">
            <h3 style="margin-bottom:10px;">Login Required</h3>
            <p style="color:var(--muted);margin-bottom:24px;">
              Please sign in or create an account to request a service.
            </p>
            <div style="display:flex;gap:14px;justify-content:center;">
              <a href="{% url 'spartans:sign_in' %}" class="btn">Sign In</a>
              <a href="{% url 'spartans:sign_up' %}" class="btn btn--ghost">Sign Up</a>
            </div>
          </div>
      {% endif %}
    </section>
  </main>
</section>


<!-- Request Created Success Modal -->
<div class="modal fade" id="requestSuccessModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content success-modal">

      <!-- Icon -->
      <div class="success-icon">
        <i class="fa fa-check"></i>
      </div>

      <!-- Body -->
      <div class="modal-body text-center">
        <h4 class="mt-3">Request Created Successfully</h4>
        <p class="text-muted">
          The service request has been recorded.  
          Our team will contact the user shortly.
        </p>
      </div>

      <!-- Footer -->
      <div class="modal-footer border-0 justify-content-center">
        <button class="btn btn-success px-4" data-dismiss="modal">
          OK
        </button>
      </div>

    </div>
  </div>
</div>














{% if messages %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    {% for message in messages %}
      {% if message.tags == 'success' %}
        $('#requestSuccessModal').modal('show');
      {% endif %}
    {% endfor %}
  });
</script>
{% endif %}

<style>
      .success-modal {
    border-radius: 15px;
    overflow: hidden;
    }

    .success-icon {
      background: linear-gradient(135deg, #28a745, #6fdc8c);
      height: 110px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .success-icon i {
      font-size: 55px;
      color: #fff;
      animation: pop 0.4s ease;
    }

    @keyframes pop {
      from { transform: scale(0); }
      to { transform: scale(1); }
    }

    label:after {
      content: " *";
      color: red;
    }
    label:not([for="price"]):not([for="notes"]):after {
      content: " *";
      color: red;
    }
    :root{
      --bg:#f4f7fb;
      --card:#ffffff;
      --accent:#111827;
      --muted:#6b7280;
      --radius:12px;
      --shadow: 0 6px 20px rgba(16,24,40,0.08);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    }
    *{box-sizing:border-box}

    .form_req{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(180deg,var(--bg),#eef2ff);
      padding:28px;
      color:#111827;
    }
    

    .card{
      width:100%;
      max-width:880px;
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      display:grid;
      grid-template-columns: 320px 1fr;
    }
    .aside{
      padding:28px;background:linear-gradient(180deg, rgba(17,24,39,0.98), rgba(31,41,55,0.95));
      color:white;display:flex;flex-direction:column;gap:12px;justify-content:center;
    }
    .logo{width:54px;height:54px;border-radius:10px;background:linear-gradient(135deg,#ef4444,#b91c1c);display:flex;align-items:center;justify-content:center;font-weight:700;color:white}
    .body{padding:28px}
    h2{margin:0 0 6px}
    p{margin:0;color:var(--muted)}
    form{margin-top:18px;display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input, select, textarea{
      width:100%;padding:10px 12px;border:1px solid #e6e9f2;border-radius:10px;background:#fff;font-size:14px
    }
    .full{grid-column:1/-1}
    .small{font-size:12px;color:var(--muted);margin-top:6px}
    .actions{grid-column:1/-1;display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:8px}
    .btn{padding:12px 16px;border-radius:10px;border:0;background:var(--accent);color:white;font-weight:600;cursor:pointer}
    .btn--ghost{background:transparent;border:1px solid #eef2ff;color:var(--muted)}
    @media(max-width:880px){.card{grid-template-columns:1fr}form{grid-template-columns:1fr}}
</style>

{%endblock%}